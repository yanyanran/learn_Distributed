# VM-FT -- 容错虚拟机

### VM-FT 核心：主备份

实现主备份的两种方法：

- **State transfer（状态转移）**【传输数据量多，所需带宽大】
- **State Machine（备份状态机）**【不确定操作干扰，复杂，但传输数据少】

备份状态机=>***确定性重放***：允许记录主服务器的执行，并确保备份以相同方式执行。容错(FT)是基于确定性重放的

![](https://github.com/yanyanran/pictures/blob/main/VM-FT.png?raw=true)

#### 容错FT设计

VM的虚拟磁盘位于共享存储上【主/备VM都可以访问其输入和输出】

但在网络层面只有主VM通知其在网络上的存在【所有网络输出都进入主VM】

主VM收到输入=>日志通道的网络连接=>发到备VM【此时主备VM的执行相同】

但备VM的输出会被删除=>只有主VM返回给客户机实际输出



#### FT容错协议

主机失败=>避免丢失数据=>在日志通道上使用协议来增加日志条目

